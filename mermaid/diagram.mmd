graph TD

%% =====================================================
%% Global Styling
%% =====================================================
%% fille = background color | Stroke = boarder color | stroke-width = border thickness | x = text color
classDef startNode fill:#2d3436,stroke:#0984e3,stroke-width:4px,color:#fff
classDef neutral fill:#f5f6fa,stroke:#7f8c8d,stroke-width:2px
classDef teamA_Adv fill:#d4edda,stroke:#28a745,stroke-width:2px
classDef teamB_Adv fill:#f8d7da,stroke:#dc3545,stroke-width:2px
classDef suddenDeath fill:#fff3cd,stroke:#ffc107,stroke-width:2px
classDef terminalA fill:#00b894,stroke:#006266,stroke-width:3px,color:#fff
classDef terminalB fill:#d63031,stroke:#6D0000,stroke-width:3px,color:#fff
%% text
%% Text color: black for light nodes, white for dark nodes
classDef startNode fill:#2d3436,stroke:#0984e3,stroke-width:4px,color:#fff
classDef neutral fill:#f5f6fa,stroke:#7f8c8d,stroke-width:2px,color:#111
classDef teamA_Adv fill:#d4edda,stroke:#28a745,stroke-width:2px,color:#111
classDef teamB_Adv fill:#f8d7da,stroke:#dc3545,stroke-width:2px,color:#111
classDef suddenDeath fill:#fff3cd,stroke:#ffc107,stroke-width:2px,color:#111
classDef terminalA fill:#00b894,stroke:#006266,stroke-width:3px,color:#fff
classDef terminalB fill:#d63031,stroke:#6D0000,stroke-width:3px,color:#fff


%% =====================================================
%% Initial State
%% =====================================================
%% Each subgraph is to group the shot round
%% subgraphx[...] = groups a set of nodes inside a box
%% x gives the unique ID
%% ["...] shows the title
%% :::startNode applies the style

subgraph Phase_Start["Initial State"]
  S0["(0-0)<br/>A: 2.00 | B: 2.00"]:::startNode
end

%% =====================================================
%% Regulation Rounds
%% =====================================================
%% REG1_1_0 is:
%% REG = Shot Number
%% REG1_0_1 = score (A goals = 1 | B goals = 0)
subgraph REG_1["Shot 1 - Team A attempt 1"]
  REG1_0_0["(0-0)<br/>A: 2.56 | B: 1.64"]:::teamB_Adv
  REG1_1_0["(1-0)<br/>A: 1.39 | B: 3.57"]:::teamA_Adv
end
subgraph REG_2["Shot 2 - Team B attempt 1 - End of Round 1"]
  REG2_0_0["(0-0)<br/>A: 2.00 | B: 2.00"]:::neutral
  REG2_0_1["(0-1)<br/>A: 5.88 | B: 1.20"]:::teamB_Adv
  REG2_1_0["(1-0)<br/>A: 1.20 | B: 5.88"]:::teamA_Adv
  REG2_1_1["(1-1)<br/>A: 2.00 | B: 2.00"]:::neutral
end
subgraph REG_3["Shot 3 - Team A attempt 2"]
  REG3_0_0["(0-0)<br/>A: 2.63 | B: 1.61"]:::teamB_Adv
  REG3_0_1["(0-1)<br/>A: 14.29 | B: 1.08"]:::teamB_Adv
  REG3_1_0["(1-0)<br/>A: 1.32 | B: 4.17"]:::teamA_Adv
  REG3_1_1["(1-1)<br/>A: 2.63 | B: 1.61"]:::teamB_Adv
  REG3_2_0["(2-0)<br/>A: 1.04 | B: 25.00"]:::teamA_Adv
  REG3_2_1["(2-1)<br/>A: 1.32 | B: 4.17"]:::teamA_Adv
end
subgraph REG_4["Shot 4 - Team B attempt 2 - End of Round 2"]
  REG4_0_0["(0-0)<br/>A: 2.00 | B: 2.00"]:::neutral
  REG4_0_1["(0-1)<br/>A: 9.09 | B: 1.12"]:::teamB_Adv
  REG4_0_2["(0-2)<br/>A: INF | B: 1.00"]:::terminalB
  REG4_1_0["(1-0)<br/>A: 1.12 | B: 9.09"]:::teamA_Adv
  REG4_1_1["(1-1)<br/>A: 2.00 | B: 2.00"]:::neutral
  REG4_1_2["(1-2)<br/>A: 9.09 | B: 1.12"]:::teamB_Adv
  REG4_2_0["(2-0)<br/>A: 1.00 | B: INF"]:::terminalA
  REG4_2_1["(2-1)<br/>A: 1.12 | B: 9.09"]:::teamA_Adv
  REG4_2_2["(2-2)<br/>A: 2.00 | B: 2.00"]:::neutral
end
subgraph REG_5["Shot 5 - Team A attempt 3"]
  REG5_0_0["(0-0)<br/>A: 2.94 | B: 1.52"]:::teamB_Adv
  REG5_0_1["(0-1)<br/>A: 6.25 | B: 1.19"]:::teamB_Adv
%%   REG5_0_2["(0-2)<br/>A: INF | B: 1.00"]:::terminalB
  REG5_1_0["(1-0)<br/>A: 1.19 | B: 6.25"]:::teamA_Adv
  REG5_1_1["(1-1)<br/>A: 2.94 | B: 1.52"]:::teamB_Adv
  REG5_1_2["(1-2)<br/>A: 6.25 | B: 1.19"]:::teamB_Adv
  REG5_2_0["(2-0)<br/>A: 1.00 | B: INF"]:::terminalA
  REG5_2_1["(2-1)<br/>A: 1.19 | B: 6.25"]:::teamA_Adv
  REG5_2_2["(2-2)<br/>A: 2.94 | B: 1.52"]:::teamB_Adv
%%   REG5_3_0["(3-0)<br/>A: 1.00 | B: INF"]:::terminalA
  REG5_3_1["(3-1)<br/>A: 1.00 | B: INF"]:::terminalA
  REG5_3_2["(3-2)<br/>A: 1.19 | B: 6.25"]:::teamA_Adv
end
subgraph REG_6["Shot 6 - Team B attempt 3 - End of Round 3"]
  REG6_0_0["(0-0)<br/>A: 2.00 | B: 2.00"]:::neutral
  REG6_0_1["(0-1)<br/>A: INF | B: 1.00"]:::terminalB
  REG6_0_2["(0-2)<br/>A: INF | B: 1.00"]:::terminalB
%%   REG6_0_3["(0-3)<br/>A: INF | B: 1.00"]:::terminalB
  REG6_1_0["(1-0)<br/>A: 1.00 | B: INF"]:::terminalA
  REG6_1_1["(1-1)<br/>A: 2.00 | B: 2.00"]:::neutral
  REG6_1_2["(1-2)<br/>A: INF | B: 1.00"]:::terminalB
  REG6_1_3["(1-3)<br/>A: INF | B: 1.00"]:::terminalB
%%   REG6_2_0["(2-0)<br/>A: 1.00 | B: INF"]:::terminalA
  REG6_2_1["(2-1)<br/>A: 1.00 | B: INF"]:::terminalA
  REG6_2_2["(2-2)<br/>A: 2.00 | B: 2.00"]:::neutral
  REG6_2_3["(2-3)<br/>A: INF | B: 1.00"]:::terminalB
%%   REG6_3_0["(3-0)<br/>A: 1.00 | B: INF"]:::terminalA
%%   REG6_3_1["(3-1)<br/>A: 1.00 | B: INF"]:::terminalA
  REG6_3_2["(3-2)<br/>A: 1.00 | B: INF"]:::terminalA
  REG6_3_3["(3-3)<br/>A: 2.00 | B: 2.00"]:::neutral
end

subgraph SD_7["Sudden Death - Team A shoots then Team B responds"]
  SD7_0_0["(0-0)<br/>A: 2.94 | B: 1.52"]:::suddenDeath
  SD7_1_0["(1-0)<br/>A: 1.19 | B: 6.25"]:::suddenDeath
  SD7_1_1["(1-1)<br/>A: 2.94 | B: 1.52"]:::suddenDeath
  SD7_2_1["(2-1)<br/>A: 1.19 | B: 6.25"]:::suddenDeath
  SD7_2_2["(2-2)<br/>A: 2.94 | B: 1.52"]:::suddenDeath
  SD7_3_2["(3-2)<br/>A: 1.19 | B: 6.25"]:::suddenDeath
  SD7_3_3["(3-3)<br/>A: 2.94 | B: 1.52"]:::suddenDeath
  SD7_4_3["(4-3)<br/>A: 1.19 | B: 6.25"]:::suddenDeath
end

%% =====================================================
%% Regulation Transitions
%% =====================================================
%% Transitions (ALWAYS write Miss first, then Goal to keep link coloring correct)
S0 -- Miss --> REG1_0_0
S0 -- Goal --> REG1_1_0
REG1_0_0 -- Miss --> REG2_0_0
REG1_0_0 -- Goal --> REG2_0_1
REG1_1_0 -- Miss --> REG2_1_0
REG1_1_0 -- Goal --> REG2_1_1
REG2_0_0 -- Miss --> REG3_0_0
REG2_0_0 -- Goal --> REG3_1_0
REG2_0_1 -- Miss --> REG3_0_1
REG2_0_1 -- Goal --> REG3_1_1
REG2_1_0 -- Miss --> REG3_1_0
REG2_1_0 -- Goal --> REG3_2_0
REG2_1_1 -- Miss --> REG3_1_1
REG2_1_1 -- Goal --> REG3_2_1
REG3_0_0 -- Miss --> REG4_0_0
REG3_0_0 -- Goal --> REG4_0_1
REG3_0_1 -- Miss --> REG4_0_1
REG3_0_1 -- Goal --> REG4_0_2
REG3_1_0 -- Miss --> REG4_1_0
REG3_1_0 -- Goal --> REG4_1_1
REG3_1_1 -- Miss --> REG4_1_1
REG3_1_1 -- Goal --> REG4_1_2
REG3_2_0 -- Miss --> REG4_2_0
REG3_2_0 -- Goal --> REG4_2_1
REG3_2_1 -- Miss --> REG4_2_1
REG3_2_1 -- Goal --> REG4_2_2
REG4_0_0 -- Miss --> REG5_0_0
REG4_0_0 -- Goal --> REG5_1_0
REG4_0_1 -- Miss --> REG5_0_1
REG4_0_1 -- Goal --> REG5_1_1
REG4_1_0 -- Miss --> REG5_1_0
REG4_1_0 -- Goal --> REG5_2_0
REG4_1_1 -- Miss --> REG5_1_1
REG4_1_1 -- Goal --> REG5_2_1
REG4_1_2 -- Miss --> REG5_1_2
REG4_1_2 -- Goal --> REG5_2_2
REG4_2_1 -- Miss --> REG5_2_1
REG4_2_1 -- Goal --> REG5_3_1
REG4_2_2 -- Miss --> REG5_2_2
REG4_2_2 -- Goal --> REG5_3_2
REG5_0_0 -- Miss --> REG6_0_0
REG5_0_0 -- Goal --> REG6_0_1
REG5_0_1 -- Miss --> REG6_0_1
REG5_0_1 -- Goal --> REG6_0_2
REG5_1_0 -- Miss --> REG6_1_0
REG5_1_0 -- Goal --> REG6_1_1
REG5_1_1 -- Miss --> REG6_1_1
REG5_1_1 -- Goal --> REG6_1_2
REG5_1_2 -- Miss --> REG6_1_2
REG5_1_2 -- Goal --> REG6_1_3
REG5_2_1 -- Miss --> REG6_2_1
REG5_2_1 -- Goal --> REG6_2_2
REG5_2_2 -- Miss --> REG6_2_2
REG5_2_2 -- Goal --> REG6_2_3
REG5_3_2 -- Miss --> REG6_3_2
REG5_3_2 -- Goal --> REG6_3_3
REG6_0_0 -- Miss --> SD7_0_0
REG6_0_0 -- Goal --> SD7_1_0
REG6_1_1 -- Miss --> SD7_1_1
REG6_1_1 -- Goal --> SD7_2_1
REG6_2_2 -- Miss --> SD7_2_2
REG6_2_2 -- Goal --> SD7_3_2
REG6_3_3 -- Miss --> SD7_3_3
REG6_3_3 -- Goal --> SD7_4_3


%% =====================================================
%% Sudden Death (GENERIC, LOOPING)
%% =====================================================

SD_AWIN["Team A Wins<br/>A: 1.00 | B: INF"]:::terminalA
SD_BWIN["Team B Wins<br/>A: INF | B: 1.00"]:::terminalB
SD_TIE["Tie continues<br/>A: 2.00 | B: 2.00"]:::suddenDeath
SD_AWIN["Team A Wins<br/>A: 1.00 | B: INF"]:::terminalA
SD_BWIN["Team B Wins<br/>A: INF | B: 1.00"]:::terminalB
SD7_0_0 -- "B Miss" --> SD_TIE
SD7_0_0 -- "B Goal" --> SD_BWIN
SD7_1_0 -- "B Miss" --> SD_AWIN
SD7_1_0 -- "B Goal" --> SD_TIE
SD7_1_1 -- "B Miss" --> SD_TIE
SD7_1_1 -- "B Goal" --> SD_BWIN
SD7_2_1 -- "B Miss" --> SD_AWIN
SD7_2_1 -- "B Goal" --> SD_TIE
SD7_2_2 -- "B Miss" --> SD_TIE
SD7_2_2 -- "B Goal" --> SD_BWIN
SD7_3_2 -- "B Miss" --> SD_AWIN
SD7_3_2 -- "B Goal" --> SD_TIE
SD7_3_3 -- "B Miss" --> SD_TIE
SD7_3_3 -- "B Goal" --> SD_BWIN
SD7_4_3 -- "B Miss" --> SD_AWIN
SD7_4_3 -- "B Goal" --> SD_TIE

%% =====================================================
%% Link Styling (Regulation Only)
%% =====================================================
%% - Default = Miss (red)
%% - Odd indices = Goal (green) because we always write Miss then Goal
linkStyle default stroke:#d63031,stroke-width:2px
linkStyle 1,3,5,7,9,11,13,15,17,19,21,23,25,27,29,31,33,35,37,39,41,43,45,47,49,51,53,55,57,59,61,63,65,67,69,71,73,75,77,79 stroke:#00b894,stroke-width:2px