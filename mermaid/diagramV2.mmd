%% %%{init: {'theme': 'dark'}}%%
graph TD
%% Uses 8 seperate nodes to represent the different sudden death scenarios 
%% Where each node represents a specific score state
%% Less Clutter, but doesnt look as clean

%% =====================================================
%% Global Styling
%% =====================================================
%% fille = background color | Stroke = boarder color | stroke-width = border thickness | x = text color
classDef startNode fill:#2d3436,stroke:#0984e3,stroke-width:4px,color:#fff
classDef neutral fill:#f5f6fa,stroke:#7f8c8d,stroke-width:2px
classDef teamA_Adv fill:#d4edda,stroke:#28a745,stroke-width:2px
classDef teamB_Adv fill:#f8d7da,stroke:#dc3545,stroke-width:2px
classDef suddenDeath fill:#fff3cd,stroke:#ffc107,stroke-width:2px
classDef terminalA fill:#00b894,stroke:#006266,stroke-width:3px,color:#fff
classDef terminalB fill:#d63031,stroke:#6D0000,stroke-width:3px,color:#fff

%% Text color: black for light nodes, white for dark nodes
classDef startNode fill:#2d3436,stroke:#0984e3,stroke-width:4px,color:#fff
classDef neutral fill:#f5f6fa,stroke:#7f8c8d,stroke-width:2px,color:#111
classDef teamA_Adv fill:#d4edda,stroke:#28a745,stroke-width:2px,color:#111
classDef teamB_Adv fill:#f8d7da,stroke:#dc3545,stroke-width:2px,color:#111
classDef suddenDeath fill:#fff3cd,stroke:#ffc107,stroke-width:2px,color:#111
classDef terminalA fill:#00b894,stroke:#006266,stroke-width:3px,color:#fff
classDef terminalB fill:#d63031,stroke:#6D0000,stroke-width:3px,color:#fff


%% =====================================================
%% Initial State
%% =====================================================
%% Each subgraph is to group the shot round
%% subgraphx[...] = groups a set of nodes inside a box
%% x gives the unique ID
%% ["...] shows the title
%% :::startNode applies the style

subgraph Phase_Start["Initial State"]
  S0("(0-0)<br/>A: 2.00 | B: 2.00"):::startNode
end

%% =====================================================
%% Regulation Rounds
%% =====================================================
%% REG1_1_0 is:
%% REG = Shot Number
%% REG1_0_1 = score (A goals = 1 | B goals = 0)
subgraph REG_1["Shot 1 - Team A attempt 1"]
  REG1_0_0("(0-0)<br/>A: 2.56 | B: 1.64"):::teamB_Adv
  REG1_1_0("(1-0)<br/>A: 1.39 | B: 3.57"):::teamA_Adv
end
subgraph REG_2["Shot 2 - Team B attempt 1 - End of Round 1"]
  REG2_0_0("(0-0)<br/>A: 2.00 | B: 2.00"):::neutral
  REG2_0_1("(0-1)<br/>A: 5.88 | B: 1.20"):::teamB_Adv
  REG2_1_0("(1-0)<br/>A: 1.20 | B: 5.88"):::teamA_Adv
  REG2_1_1("(1-1)<br/>A: 2.00 | B: 2.00"):::neutral
end
subgraph REG_3["Shot 3 - Team A attempt 2"]
  REG3_0_0("(0-0)<br/>A: 2.63 | B: 1.61"):::teamB_Adv
  REG3_0_1("(0-1)<br/>A: 14.29 | B: 1.08"):::teamB_Adv
  REG3_1_0("(1-0)<br/>A: 1.32 | B: 4.17"):::teamA_Adv
  REG3_1_1("(1-1)<br/>A: 2.63 | B: 1.61"):::teamB_Adv
  REG3_2_0("(2-0)<br/>A: 1.04 | B: 25.00"):::teamA_Adv
  REG3_2_1("(2-1)<br/>A: 1.32 | B: 4.17"):::teamA_Adv
end
subgraph REG_4["Shot 4 - Team B attempt 2 - End of Round 2"]
  REG4_0_0("(0-0)<br/>A: 2.00 | B: 2.00"):::neutral
  REG4_0_1("(0-1)<br/>A: 9.09 | B: 1.12"):::teamB_Adv
  REG4_1_0("(1-0)<br/>A: 1.12 | B: 9.09"):::teamA_Adv
  REG4_1_1("(1-1)<br/>A: 2.00 | B: 2.00"):::neutral
  REG4_1_2("(1-2)<br/>A: 9.09 | B: 1.12"):::teamB_Adv
  REG4_2_1("(2-1)<br/>A: 1.12 | B: 9.09"):::teamA_Adv
  REG4_2_2("(2-2)<br/>A: 2.00 | B: 2.00"):::neutral
end
subgraph REG_5["Shot 5 - Team A attempt 3"]
  REG5_0_0("(0-0)<br/>A: 2.94 | B: 1.52"):::teamB_Adv
  REG5_1_0("(1-0)<br/>A: 1.19 | B: 6.25"):::teamA_Adv
  REG5_1_1("(1-1)<br/>A: 2.94 | B: 1.52"):::teamB_Adv
  REG5_2_1("(2-1)<br/>A: 1.19 | B: 6.25"):::teamA_Adv
  REG5_2_2("(2-2)<br/>A: 2.94 | B: 1.52"):::teamB_Adv
  REG5_3_2("(3-2)<br/>A: 1.19 | B: 6.25"):::teamA_Adv
end
subgraph REG_6["Shot 6 - Team B attempt 3 - End of Round 3"]
  REG6_0_0("(0-0)<br/>A: 2.00 | B: 2.00"):::neutral
  REG6_1_1("(1-1)<br/>A: 2.00 | B: 2.00"):::neutral
  REG6_2_2("(2-2)<br/>A: 2.00 | B: 2.00"):::neutral
  REG6_3_3("(3-3)<br/>A: 2.00 | B: 2.00"):::neutral
end

%% =====================================================
%% Sudden Death - Game State Model (2 nodes with spacing)
%% =====================================================

subgraph SD_A["Sudden Death - Team A Shot"]
  SD_A_MISS("A misses<br/>(Score Tied)<br/>A: 2.94 | B: 1.52"):::suddenDeath
  %% SPACER_1[" "]:::invisible
  %% SPACER_2[" "]:::invisible
  %% SPACER_3[" "]:::invisible
  %% SPACER_4[" "]:::invisible
  %% SPACER_5[" "]:::invisible
  %% SPACER_6[" "]:::invisible
  SD_A_SCORE("A scores<br/>(Team A Leads by 1)<br/>A: 1.19 | B: 6.25"):::suddenDeath
end

subgraph SD_B["Sudden Death - Team B responds"]
  SD_CONTINUES("Tie continues<br/>A: 2.00 | B: 2.00"):::suddenDeath
  %% SPACER_7[" "]:::invisible
  %% SPACER_8[" "]:::invisible
  %% SPACER_9[" "]:::invisible
  SD_AWIN("Team A Wins<br/>A: 1.00 | B: INF"):::terminalA
  %% SPACER_10[" "]:::invisible
  %% SPACER_11[" "]:::invisible
  %% SPACER_12[" "]:::invisible
  SD_BWIN("Team B Wins<br/>A: INF | B: 1.00"):::terminalB
end

%% Define invisible class for spacers
classDef invisible fill:none,stroke:none,color:transparent

%% =====================================================
%% Regulation Transitions
%% =====================================================
%% Transitions (ALWAYS write Miss first, then Goal to keep link coloring correct)
S0 -- Miss --> REG1_0_0
S0 -- Goal --> REG1_1_0
REG1_0_0 -- Miss --> REG2_0_0
REG1_0_0 -- Goal --> REG2_0_1
REG1_1_0 -- Miss --> REG2_1_0
REG1_1_0 -- Goal --> REG2_1_1
REG2_0_0 -- Miss --> REG3_0_0
REG2_0_0 -- Goal --> REG3_1_0
REG2_0_1 -- Miss --> REG3_0_1
REG2_0_1 -- Goal --> REG3_1_1
REG2_1_0 -- Miss --> REG3_1_0
REG2_1_0 -- Goal --> REG3_2_0
REG2_1_1 -- Miss --> REG3_1_1
REG2_1_1 -- Goal --> REG3_2_1
REG3_0_0 -- Miss --> REG4_0_0
REG3_0_0 -- Goal --> REG4_0_1
REG3_0_1 -- Miss --> REG4_0_1
%% REG3_0_1 -- Goal would lead to REG4_0_2 (terminal - game over)
REG3_1_0 -- Miss --> REG4_1_0
REG3_1_0 -- Goal --> REG4_1_1
REG3_1_1 -- Miss --> REG4_1_1
REG3_1_1 -- Goal --> REG4_1_2
%% REG3_2_0 -- Miss would lead to REG4_2_0 (terminal - game over)
REG3_2_0 -- Goal --> REG4_2_1
REG3_2_1 -- Miss --> REG4_2_1
REG3_2_1 -- Goal --> REG4_2_2
REG4_0_0 -- Miss --> REG5_0_0
REG4_0_0 -- Goal --> REG5_1_0
%% REG4_0_1 -- Miss would lead to REG5_0_1 (terminal - game over)
REG4_0_1 -- Goal --> REG5_1_1
REG4_1_0 -- Miss --> REG5_1_0
%% REG4_1_0 -- Goal would lead to REG5_2_0 (terminal - game over)
REG4_1_1 -- Miss --> REG5_1_1
REG4_1_1 -- Goal --> REG5_2_1
%% REG4_1_2 -- Miss would lead to REG5_1_2 (terminal - game over)
REG4_1_2 -- Goal --> REG5_2_2
REG4_2_1 -- Miss --> REG5_2_1
%% REG4_2_1 -- Goal would lead to REG5_3_1 (terminal - game over)
REG4_2_2 -- Miss --> REG5_2_2
REG4_2_2 -- Goal --> REG5_3_2
REG5_0_0 -- Miss --> REG6_0_0
%% REG5_0_0 -- Goal would lead to REG6_0_1 (terminal - game over)
%% REG5_1_0 -- Miss would lead to REG6_1_0 (terminal - game over)
REG5_1_0 -- Goal --> REG6_1_1
REG5_1_1 -- Miss --> REG6_1_1
%% REG5_1_1 -- Goal would lead to REG6_1_2 (terminal - game over)
%% REG5_2_1 -- Miss would lead to REG6_2_1 (terminal - game over)
REG5_2_1 -- Goal --> REG6_2_2
REG5_2_2 -- Miss --> REG6_2_2
%% REG5_2_2 -- Goal would lead to REG6_2_3 (terminal - game over)
%% REG5_3_2 -- Miss would lead to REG6_3_2 (terminal - game over)
REG5_3_2 -- Goal --> REG6_3_3

%% =====================================================
%% Round 3 to Sudden Death Transitions
%% =====================================================
REG6_0_0 -- Miss --> SD_A_MISS
REG6_0_0 -- Goal --> SD_A_SCORE
REG6_1_1 -- Miss --> SD_A_MISS
REG6_1_1 -- Goal --> SD_A_SCORE
REG6_2_2 -- Miss --> SD_A_MISS
REG6_2_2 -- Goal --> SD_A_SCORE
REG6_3_3 -- Miss --> SD_A_MISS
REG6_3_3 -- Goal --> SD_A_SCORE

%% =====================================================
%% Sudden Death Transitions
%% =====================================================
%% Team B responds to Team A's miss
SD_A_MISS -- "B Miss" --> SD_CONTINUES
SD_A_MISS -- "B Goal" --> SD_BWIN

%% Team B responds to Team A's score
SD_A_SCORE -- "B Miss" --> SD_AWIN
SD_A_SCORE -- "B Goal" --> SD_CONTINUES

%% Loop back to start of sudden death if tie continues
SD_CONTINUES -- "Next round" --> SD_A_MISS

%% =====================================================
%% Link Styling
%% =====================================================
%% Default = Miss (red)
%% Odd indices = Goal (green) because we always write Miss then Goal
%% 
%% Regulation transitions: Links 0-39 (odd indices are goals)
%% Round 3 to SD: Links 40-47 (odd indices are goals)
%% SD internal: Links 48-52 (49 and 51 are "B Goal" = green)
linkStyle default stroke:#d63031,stroke-width:2px,color:#d63031
linkStyle 1,3,5,7,9,11,13,15,18,20,21,23,25,26,29,30,33,35,37,39,41,43,45,47,49,51 stroke:#00b894,stroke-width:2px,color:#00b894

%% Optional: Style the loop back as neutral yellow
linkStyle 52 stroke:#ffc107,stroke-width:2px,color:#ffc107